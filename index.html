<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">
    <title>Dza-Genius V14 (Pro & Free)</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&family=Fira+Code:wght@400&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/adhan/4.4.4/Adhan.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        :root { --primary: #10b981; --gold: #fbbf24; --bg-dark: #0f172a; --safe-top: env(safe-area-inset-top, 20px); --safe-bottom: env(safe-area-inset-bottom, 20px); }
        body { font-family: 'Cairo', sans-serif; background: var(--bg-dark); color: #f8fafc; height: 100dvh; overflow: hidden; background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 24px 24px; }
        .app-layout { display: flex; flex-direction: column; height: 100%; padding-top: var(--safe-top); padding-bottom: calc(75px + var(--safe-bottom)); }
        
        .page { display: none; height: 100%; overflow-y: auto; padding: 16px; scroll-behavior: smooth; padding-bottom: 100px; }
        .page.active { display: block; animation: fadeUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        
        /* Chat Bubbles */
        .msg-bubble { max-width: 90%; padding: 12px 16px; margin-bottom: 12px; border-radius: 18px; position: relative; font-size: 15px; line-height: 1.6; box-shadow: 0 2px 5px rgba(0,0,0,0.1); word-wrap: break-word; }
        .msg-bot { background: #1e293b; color: #e2e8f0; border: 1px solid #334155; border-bottom-left-radius: 4px; }
        .msg-user { background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; margin-right: auto; border-bottom-right-radius: 4px; }
        .msg-vip { background: linear-gradient(135deg, #b45309 0%, #78350f 100%); border: 1px solid #f59e0b; } /* Style for VIP responses */

        /* Code Blocks */
        pre { background: #111827 !important; padding: 0 !important; border-radius: 8px !important; overflow: hidden; margin: 10px 0; border: 1px solid #374151; direction: ltr; }
        pre code { font-family: 'Fira Code', monospace; font-size: 13px; display: block; padding: 12px; overflow-x: auto; }
        .code-header { background: #1f2937; padding: 4px 12px; font-size: 11px; color: #9ca3af; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #374151; }

        /* UI Components */
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); border-radius: 20px; padding: 16px; margin-bottom: 14px; transition: transform 0.2s; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: calc(70px + var(--safe-bottom)); background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-around; padding-top: 10px; z-index: 50; }
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #64748b; width: 20%; transition: 0.3s; cursor: pointer; }
        .nav-item.active { color: var(--primary); transform: translateY(-4px); font-weight: bold; }
        
        /* Animations */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        
        /* VIP Badge Animation */
        .vip-glow { animation: goldPulse 2s infinite; }
        @keyframes goldPulse { 0% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); } 100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); } }
    </style>
</head>
<body>

    <div id="subModal" class="fixed inset-0 bg-black/80 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm animate-fadeUp">
        <div class="glass-card w-full max-w-sm bg-slate-900 border border-yellow-500/50 relative">
            <button onclick="document.getElementById('subModal').classList.add('hidden')" class="absolute top-2 left-2 text-gray-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            <div class="text-center mb-4">
                <div class="w-16 h-16 bg-yellow-500/10 rounded-full flex items-center justify-center mx-auto mb-2 border border-yellow-500/30">
                    <i class="fa-solid fa-crown text-3xl text-yellow-500"></i>
                </div>
                <h3 class="text-lg font-bold text-white">ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨ (VIP)</h3>
                <p class="text-xs text-gray-400">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø°ÙƒØ§Ø¡ GPT-4oØŒ ÙˆØ³Ø±Ø¹Ø© ÙØ§Ø¦Ù‚Ø©.</p>
            </div>
            
            <div class="bg-slate-800 p-3 rounded mb-3 border border-slate-700">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-xs text-gray-400">CCP Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Alg%C3%A9rie_Poste.svg/1200px-Alg%C3%A9rie_Poste.svg.png" class="h-4 opacity-70">
                </div>
                <p class="font-mono text-lg font-bold text-white tracking-wider text-center select-all cursor-pointer" onclick="copyToClip('00000000 00')">00000000 00</p>
                <p class="text-[10px] text-gray-500 text-center mt-1">Ø§Ù„Ø§Ø³Ù…: ÙÙ„Ø§Ù† Ø¨Ù† ÙÙ„Ø§Ù†</p>
            </div>

            <div class="bg-slate-800 p-3 rounded mb-4 border border-slate-700">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-xs text-gray-400">Baridimob (RIP)</span>
                    <i class="fa-solid fa-mobile-screen text-gray-500"></i>
                </div>
                <p class="font-mono text-xs font-bold text-white text-center select-all cursor-pointer" onclick="copyToClip('00799999000000000000')">00799999000000000000</p>
            </div>

            <p class="text-[10px] text-center text-gray-300 mb-3 bg-blue-900/20 p-2 rounded">
                ğŸ’¡ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹ØŒ ØµÙˆØ± Ø§Ù„ÙˆØµÙ„ ÙˆØ£Ø±Ø³Ù„Ù‡ Ù„Ù†Ø§ Ù„Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙÙˆØ±ÙŠ.
            </p>
            
            <button onclick="window.open('https://t.me/YOUR_USERNAME')" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2.5 rounded-lg text-xs font-bold transition flex items-center justify-center gap-2">
                <i class="fa-brands fa-telegram"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙˆØµÙ„ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
            </button>
        </div>
    </div>

    <div class="app-layout">
        <header class="flex justify-between items-center px-4 py-3 bg-slate-900/80 backdrop-blur sticky top-0 z-40 border-b border-slate-800/60">
            <div class="flex items-center gap-3">
                <div class="relative group cursor-pointer" onclick="nav('settings', document.querySelector('.nav-item:nth-child(3)'))">
                    <div id="headerAvatar" class="w-9 h-9 rounded-lg bg-gradient-to-br from-green-500 to-teal-700 flex items-center justify-center text-white font-bold text-xs shadow-lg overflow-hidden">
                        <span>DZ</span>
                    </div>
                    <div id="headerVipBadge" class="hidden absolute -bottom-1 -right-1 bg-yellow-500 text-black text-[8px] font-bold px-1 rounded-full border border-slate-900 shadow-lg shadow-yellow-500/50">PRO</div>
                </div>
                <div class="leading-tight">
                    <h1 class="font-bold text-sm text-white tracking-wide">Dza-Genius <span id="appVersion" class="text-[9px] bg-slate-800 text-gray-400 px-1 rounded border border-slate-700">Free</span></h1>
                    <div class="text-[10px] text-gray-400 cursor-pointer flex items-center gap-1 hover:text-green-300 transition" onclick="getUserLocation()">
                        <i class="fa-solid fa-location-dot"></i> <span id="headerCity">Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</span>
                    </div>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="clearChat()" class="w-8 h-8 rounded-full bg-slate-800 text-red-400 border border-slate-700 flex items-center justify-center hover:bg-red-900/20 transition">
                    <i class="fa-solid fa-eraser text-xs"></i>
                </button>
            </div>
        </header>

        <main id="view-chat" class="page active">
            <div id="chatContainer" class="min-h-[60vh] flex flex-col justify-end"></div>
            
            <div class="fixed bottom-[calc(70px+var(--safe-bottom))] left-0 right-0 px-3 py-2 z-40 bg-gradient-to-t from-slate-900 via-slate-900/95 to-transparent">
                <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide mb-1 px-1" id="quickSuggestions">
                    <button onclick="setInput('Ø§Ø±Ø³Ù… Ù„ÙŠ Ø´Ø¹Ø§Ø± ÙØ±ÙŠÙ‚ ÙƒØ±Ø© Ù‚Ø¯Ù…')" class="whitespace-nowrap bg-purple-900/40 border border-purple-500/30 text-[10px] text-purple-300 px-3 py-1.5 rounded-full hover:bg-purple-800">ğŸ¨ Ø±Ø³Ù…</button>
                    <button onclick="setInput('Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆØ±Ùˆ Ø§Ù„ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø³ÙƒÙˆØ§Ø±')" class="whitespace-nowrap bg-slate-800/80 border border-slate-700 text-[10px] text-gray-300 px-3 py-1.5 rounded-full hover:bg-slate-700">ğŸ’¶ Ø§Ù„Ø³ÙƒÙˆØ§Ø±</button>
                    <button onclick="setInput('Ø§ÙƒØªØ¨ Ù„ÙŠ Ø·Ù„Ø¨ Ø®Ø·ÙŠ')" class="whitespace-nowrap bg-slate-800/80 border border-slate-700 text-[10px] text-gray-300 px-3 py-1.5 rounded-full hover:bg-slate-700">ğŸ“ Ø·Ù„Ø¨ Ø®Ø·ÙŠ</button>
                </div>

                <div class="max-w-3xl mx-auto flex items-end gap-2 bg-slate-800/90 backdrop-blur p-1.5 rounded-[24px] border border-slate-700 shadow-2xl">
                    <button id="micBtn" onclick="toggleVoice()" class="w-10 h-10 rounded-full bg-slate-700/50 text-gray-400 hover:text-white transition flex-shrink-0">
                        <i class="fa-solid fa-microphone"></i>
                    </button>
                    <textarea id="msgInput" rows="1" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§..." class="flex-1 bg-transparent text-white text-sm py-3 px-1 focus:outline-none resize-none max-h-32 placeholder-slate-500 dir-rtl" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
                    <button onclick="sendMessage()" id="sendBtn" class="w-10 h-10 rounded-full bg-green-600 hover:bg-green-500 text-white shadow-lg shadow-green-900/30 transition transform active:scale-90 flex-shrink-0 flex items-center justify-center">
                        <i class="fa-solid fa-paper-plane text-sm"></i>
                    </button>
                </div>
            </div>
        </main>

        <main id="view-tools" class="page">
            <div class="glass-card bg-gradient-to-br from-blue-900/20 to-slate-900 border-r-4 border-blue-500 relative overflow-hidden">
                <div class="flex justify-between items-start z-10 relative">
                    <div>
                        <h3 class="text-xs text-blue-300 font-bold mb-1"><i class="fa-solid fa-cloud"></i> Ø§Ù„Ø·Ù‚Ø³</h3>
                        <div class="flex items-baseline gap-2">
                            <span id="weatherTemp" class="text-3xl font-black text-white">--Â°</span>
                            <span id="weatherDesc" class="text-xs text-gray-400">..</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <div id="weatherCity" class="text-xs font-bold text-white mb-1">---</div>
                        <div class="text-[10px] text-blue-400"><i class="fa-solid fa-wind"></i> <span id="windSpeed">--</span> km/h</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="glass-card mb-0 p-3 bg-gradient-to-br from-green-900/20 to-slate-900 border-green-500/20">
                    <div class="text-[10px] text-green-400 mb-1 font-bold">Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</div>
                    <div id="nextPrayerName" class="text-xs text-gray-300">--</div>
                    <div id="nextPrayerCounter" class="text-xl font-mono font-bold text-white mt-1">--:--</div>
                </div>
                <div class="glass-card mb-0 p-3 bg-gradient-to-br from-indigo-900/20 to-slate-900 border-indigo-500/20 text-center relative overflow-hidden">
                    <div class="text-[10px] text-indigo-400 mb-1 font-bold">Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø©</div>
                    <div class="relative w-12 h-12 mx-auto mt-1 border-2 border-indigo-500/30 rounded-full flex items-center justify-center">
                        <i id="qiblaArrow" class="fa-solid fa-location-arrow text-xl text-white transition-all duration-1000"></i>
                    </div>
                </div>
            </div>

            <div class="glass-card border-yellow-500/30">
                <h3 class="text-xs font-bold text-yellow-500 mb-3 flex justify-between">
                    <span><i class="fa-solid fa-money-bill-transfer"></i> Ø§Ù„Ø³ÙƒÙˆØ§Ø±</span>
                </h3>
                <div class="flex gap-2 items-center mb-2">
                    <input type="number" id="currAmount" value="100" class="w-1/3 bg-slate-800 border border-slate-600 rounded p-2 text-center text-sm font-bold text-white">
                    <select id="currType" class="bg-slate-800 border border-slate-600 rounded p-2 text-xs text-white">
                        <option value="eur">â‚¬ Ø£ÙˆØ±Ùˆ</option>
                        <option value="usd">$ Ø¯ÙˆÙ„Ø§Ø±</option>
                    </select>
                    <i class="fa-solid fa-arrow-left text-gray-500 text-xs"></i>
                    <div id="currResult" class="flex-1 text-left font-mono font-bold text-green-400 text-sm">-- DA</div>
                </div>
            </div>

            <div class="glass-card mt-3 bg-blue-900/10 border-blue-500/20">
                <h3 class="text-xs font-bold text-blue-400 mb-2">Ø­Ø³Ø§Ø¨ Ù…ÙØªØ§Ø­ Ø§Ù„Ø¨Ø±ÙŠØ¯ (CCP)</h3>
                <div class="flex gap-2">
                    <input type="number" id="ccpInput" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ø¯ÙˆÙ† Ù…ÙØªØ§Ø­" class="w-2/3 bg-slate-900 p-2 rounded border border-slate-700 text-center text-sm text-white">
                    <button onclick="calcKey()" class="w-1/3 bg-blue-600 hover:bg-blue-500 text-white rounded text-xs font-bold">Ø§Ø­Ø³Ø¨</button>
                </div>
                <div id="ccpRes" class="text-center font-bold text-lg mt-2 text-white min-h-[20px]"></div>
            </div>
        </main>

        <main id="view-settings" class="page">
            <h2 class="text-lg font-bold mb-4 px-1 text-gray-300">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø­Ø³Ø§Ø¨</h2>

            <div class="glass-card mb-4 border-blue-500/30 relative overflow-hidden">
                <h3 class="text-xs font-bold text-blue-400 mb-3">Ø­Ø³Ø§Ø¨ÙŠ</h3>
                
                <div id="loginBtnSection">
                    <p class="text-[10px] text-gray-400 mb-3">Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø­ÙØ¸ Ø§Ø´ØªØ±Ø§ÙƒÙƒ ÙˆØ§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©.</p>
                    <button onclick="loginWithGoogle()" class="w-full bg-white text-slate-900 font-bold py-2 rounded flex items-center justify-center gap-2 hover:bg-gray-200 transition">
                        <i class="fa-brands fa-google text-red-500"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„
                    </button>
                </div>

                <div id="userInfoSection" class="hidden flex-col gap-3">
                    <div class="flex items-center gap-3 bg-slate-800/50 p-2 rounded-lg border border-slate-700">
                        <img id="userImgDisplay" src="" class="w-10 h-10 rounded-full border border-gray-500">
                        <div>
                            <div class="flex items-center gap-2">
                                <span id="userNameDisplay" class="text-sm font-bold text-white">---</span>
                                <span id="proBadgeCard" class="hidden text-[9px] bg-yellow-500 text-black px-1.5 py-0.5 rounded font-bold shadow-md shadow-yellow-500/20"><i class="fa-solid fa-crown"></i> PRO</span>
                            </div>
                            <div id="emailDisplay" class="text-[9px] text-gray-500">...</div>
                        </div>
                    </div>
                    <button onclick="logoutApp()" class="w-full border border-red-500/30 text-red-400 py-1.5 rounded text-xs hover:bg-red-900/10 transition">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
            
            <div class="glass-card border-yellow-500/50 bg-gradient-to-br from-yellow-900/20 to-slate-900 relative overflow-hidden group">
                <div class="absolute top-0 right-0 bg-yellow-500 text-black text-[10px] font-bold px-2 py-1 rounded-bl-lg">PRO</div>
                <h3 class="text-sm font-bold text-yellow-400 mb-2"><i class="fa-solid fa-crown"></i> Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© (VIP)</h3>
                <p class="text-[10px] text-gray-300 mb-3">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.</p>
                
                <div class="flex justify-between items-center text-[10px] text-gray-400 mb-2">
                    <span>ğŸš€ Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø°ÙƒÙŠØ© (GPT-4 / Gemini)</span>
                    <i class="fa-solid fa-check text-green-400"></i>
                </div>
                <div class="flex justify-between items-center text-[10px] text-gray-400 mb-3">
                    <span>âš¡ Ø³Ø±Ø¹Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙˆØ£ÙˆÙ„ÙˆÙŠØ© Ù‚ØµÙˆÙ‰</span>
                    <i class="fa-solid fa-check text-green-400"></i>
                </div>
            
                <button onclick="openSubscriptionModal()" class="w-full py-2 bg-gradient-to-r from-yellow-600 to-yellow-500 hover:from-yellow-500 hover:to-yellow-400 text-black font-bold rounded-lg text-xs shadow-lg shadow-yellow-900/50 transition transform hover:scale-[1.02]">
                    ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¢Ù†
                </button>
            </div>

            <div class="glass-card">
                <label class="text-xs text-gray-400 font-bold mb-3 block">Ø´Ø®ØµÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯</label>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="setMode('darja', this)" class="mode-btn active bg-slate-800 p-3 rounded-xl text-xs border border-green-500 text-green-400 transition">ğŸ‡©ğŸ‡¿ Ø§Ù„Ø¯Ø§Ø±Ø¬Ø©</button>
                    <button onclick="setMode('admin', this)" class="mode-btn bg-slate-800 p-3 rounded-xl text-xs text-gray-400 border border-transparent transition">âš–ï¸ Ø¨ÙŠØ±ÙˆÙ‚Ø±Ø§Ø·ÙŠ</button>
                    <button onclick="setMode('tech', this)" class="mode-btn bg-slate-800 p-3 rounded-xl text-xs text-gray-400 border border-transparent transition">ğŸ’» Ù…Ø¨Ø±Ù…Ø¬</button>
                    <button onclick="setMode('chef', this)" class="mode-btn bg-slate-800 p-3 rounded-xl text-xs text-gray-400 border border-transparent transition">ğŸ³ Ø´Ø§Ù Ø·Ø¨Ø®</button>
                </div>
            </div>

            <button onclick="fullReset()" class="w-full mt-6 py-3 text-red-400 text-xs border border-red-900/50 rounded-xl bg-red-900/10 hover:bg-red-900/20 transition font-bold">
                <i class="fa-solid fa-triangle-exclamation"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹
            </button>
            
            <p class="text-[10px] text-gray-600 text-center mt-4 font-mono">Dza-Genius V14</p>
        </main>

        <nav class="bottom-nav">
            <div class="nav-item active" onclick="nav('chat', this)"><i class="fa-solid fa-comment-dots"></i><span>Ø´Ø§Øª</span></div>
            <div class="nav-item" onclick="nav('tools', this)"><i class="fa-solid fa-toolbox"></i><span>Ø£Ø¯ÙˆØ§Øª</span></div>
            <div class="nav-item" onclick="nav('settings', this)"><i class="fa-solid fa-sliders"></i><span>Ø­Ø³Ø§Ø¨ÙŠ</span></div>
        </nav>
    </div>

    <script>
        // --- 1. Firebase Configuration & Initialization ---
        const firebaseConfig = {
          apiKey: "AIzaSyBMPbJoYquYUf055uuzMt2IgdLDMJvvKPs",
          authDomain: "aidz-5f3c4.firebaseapp.com",
          projectId: "aidz-5f3c4",
          storageBucket: "aidz-5f3c4.firebasestorage.app",
          messagingSenderId: "921793664900",
          appId: "1:921793664900:web:81325e6ddc16bf8561efd1",
          measurementId: "G-N4SNXRYEKT"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- 2. Global State ---
        let userStatus = {
            isLoggedIn: false,
            isPro: false, // VIP Status
            uid: null,
            name: 'Guest'
        };

        let state = {
            lat: 36.75, lon: 3.05, city: "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±",
            chatHistory: [],
            mode: 'darja',
            voiceEnabled: false
        };

        // --- 3. Auth Logic ---
        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    addMessage('system', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ...');
                }).catch((error) => {
                    console.error(error);
                    alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: " + error.message);
                });
        }

        function logoutApp() {
            auth.signOut().then(() => {
                window.location.reload();
            });
        }

        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in.
                userStatus.isLoggedIn = true;
                userStatus.uid = user.uid;
                userStatus.name = user.displayName;
                
                // Update UI
                document.getElementById('loginBtnSection').style.display = 'none';
                document.getElementById('userInfoSection').style.display = 'flex';
                document.getElementById('userNameDisplay').innerText = user.displayName;
                document.getElementById('emailDisplay').innerText = user.email;
                document.getElementById('userImgDisplay').src = user.photoURL || 'https://via.placeholder.com/40';
                
                // Header Avatar Update
                const headerAv = document.getElementById('headerAvatar');
                headerAv.innerHTML = `<img src="${user.photoURL}" class="w-full h-full object-cover">`;

                // Check Subscription Status in Firestore
                checkSubscription(user.uid, user);
            } else {
                // No user is signed in.
                userStatus = { isLoggedIn: false, isPro: false, uid: null, name: 'Guest' };
                document.getElementById('loginBtnSection').style.display = 'block';
                document.getElementById('userInfoSection').style.display = 'none';
                document.getElementById('headerAvatar').innerHTML = '<span>DZ</span>';
            }
        });

        async function checkSubscription(uid, userObj) {
            const docRef = db.collection("users").doc(uid);
            
            try {
                const doc = await docRef.get();
                if (doc.exists) {
                    const data = doc.data();
                    if (data.isPro === true) {
                        activateProMode();
                    }
                } else {
                    // Create User Document if not exists
                    db.collection("users").doc(uid).set({
                        name: userObj.displayName,
                        email: userObj.email,
                        isPro: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            } catch (e) {
                console.error("Firestore Error:", e);
            }
        }

        function activateProMode() {
            userStatus.isPro = true;
            document.getElementById('proBadgeCard').classList.remove('hidden');
            document.getElementById('headerVipBadge').classList.remove('hidden');
            document.getElementById('appVersion').innerText = "VIP";
            document.getElementById('appVersion').className = "text-[9px] bg-yellow-500 text-black px-1 rounded font-bold";
            document.getElementById('headerAvatar').parentElement.classList.add('vip-glow');
            addMessage('system', 'ğŸ‘‘ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©. Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚!');
        }

        function openSubscriptionModal() { document.getElementById('subModal').classList.remove('hidden'); }
        function copyToClip(text) { 
            navigator.clipboard.writeText(text); 
            alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…: " + text); 
        }

        // --- 4. Core Logic (Pollinations + Pro Simulation) ---
        const CONFIG = {
            modes: {
                darja: { name: "Ø§Ù„Ø¯Ø§Ø±Ø¬Ø©", prompt: "You are Dza-Genius, a smart Algerian assistant. Speak Algerian Darja. Be helpful, funny, and respectful." },
                admin: { name: "Ø¥Ø¯Ø§Ø±ÙŠ", prompt: "Act as an expert in Algerian Bureaucracy. Write formal requests." },
                tech: { name: "Ù…Ø¨Ø±Ù…Ø¬", prompt: "You are a Senior Software Engineer. Provide clean code." },
                chef: { name: "Ø´Ø§Ù", prompt: "Ø£Ù†Øª Ø·Ø¨Ø§Ø® Ø¬Ø²Ø§Ø¦Ø±ÙŠ Ù…Ø­ØªØ±Ù. Ø£Ø¹Ø· ÙˆØµÙØ§Øª Ø¯Ù‚ÙŠÙ‚Ø©." }
            }
        };

        window.onload = () => {
            loadState();
            renderChat();
            getUserLocation();
            hljs.highlightAll();
            setInterval(updateTimers, 1000);
        };

        async function sendMessage() {
            const input = document.getElementById('msgInput');
            const text = input.value.trim();
            if (!text) return;

            input.value = '';
            input.style.height = 'auto';
            addMessage('user', text);
            const loaderId = addLoader();

            // Image Generation
            if (text.startsWith("Ø§Ø±Ø³Ù…") || text.toLowerCase().startsWith("draw")) {
                const prompt = text.replace(/Ø§Ø±Ø³Ù…|Ù„ÙŠ|draw/gi, "").trim();
                const imgUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?nologo=true`;
                removeLoader(loaderId);
                addMessage('assistant', `<div class="font-bold mb-2">ğŸ¨ Ù‡Ø§ Ù‡ÙŠ Ø§Ù„Ø±Ø³Ù…Ø©:</div><img src="${imgUrl}" class="ai-image w-full rounded-xl border border-green-500" onload="this.scrollIntoView()">`);
                return;
            }

            try {
                let reply = "";
                
                // VIP Logic vs Free Logic
                if (userStatus.isPro) {
                    // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù‡Ù†Ø§ Ù†Ø³ØªØ¯Ø¹ÙŠ Backend (Node.js) Ø§Ù„Ø°ÙŠ ÙŠØ­Ù…Ù„ Ù…ÙØªØ§Ø­ GPT-4
                    // Ù„Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¢Ù†ØŒ Ø³Ù†Ø³ØªØ®Ø¯Ù… Ù†Ù…ÙˆØ°Ø¬Ø§Ù‹ Ø£ÙƒØ«Ø± ØªÙ‚Ø¯Ù…Ø§Ù‹ ÙÙŠ Pollinations Ø£Ùˆ Prompt Ø£Ù‚ÙˆÙ‰
                    const systemPrompt = CONFIG.modes[state.mode].prompt + `\n[SYSTEM: You are in VIP MODE. Provide extremely detailed, high-quality answers. Use emojis.]\n[Context: ${state.city}]`;
                    const encodedPrompt = encodeURIComponent(`${systemPrompt}\nUser: ${text}`);
                    // Ù†Ø­Ø§ÙˆÙ„ ÙØ±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø£Ù‚ÙˆÙ‰ (Pollinations ÙŠØ®ØªØ§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ†Ù†Ø§ Ù†ÙˆØ¬Ù‡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡)
                    const response = await fetch(`https://text.pollinations.ai/${encodedPrompt}?model=openai`); 
                    reply = await response.text();
                    
                } else {
                    // Free Mode
                    const systemPrompt = CONFIG.modes[state.mode].prompt + `\n[Context: ${state.city}]`;
                    const encodedPrompt = encodeURIComponent(`${systemPrompt}\nUser: ${text}`);
                    const response = await fetch(`https://text.pollinations.ai/${encodedPrompt}?model=openai`);
                    reply = await response.text();
                }

                removeLoader(loaderId);
                addMessage('assistant', reply);

            } catch (error) {
                removeLoader(loaderId);
                addMessage('system', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„.');
            }
        }

        function addMessage(role, content) {
            if(role !== 'system') {
                state.chatHistory.push({ role, content });
                if(state.chatHistory.length > 30) state.chatHistory.shift(); // Save locally for now
                localStorage.setItem('dza_history', JSON.stringify(state.chatHistory));
            }

            const container = document.getElementById('chatContainer');
            const div = document.createElement('div');
            
            if (role === 'system') {
                div.className = 'text-center text-[10px] text-yellow-400 my-2 px-4 bg-yellow-900/10 rounded py-1';
                div.innerText = content;
            } else {
                // If it's a bot response and user is VIP, give it a special glow
                let bubbleClass = `msg-bubble ${role === 'user' ? 'msg-user' : 'msg-bot'}`;
                if (role === 'assistant' && userStatus.isPro) bubbleClass += ' msg-vip';

                div.className = bubbleClass;
                
                if (role === 'assistant') {
                    if(content.includes('<img')) div.innerHTML = content;
                    else {
                        div.innerHTML = marked.parse(content);
                        div.querySelectorAll('pre code').forEach((block) => {
                            hljs.highlightElement(block);
                        });
                    }
                } else {
                    div.innerText = content;
                }
            }
            container.appendChild(div);
            document.getElementById('view-chat').scrollTo(0, document.getElementById('view-chat').scrollHeight);
        }

        // --- 5. Helper Functions (Standard) ---
        function renderChat() {
            const container = document.getElementById('chatContainer');
            container.innerHTML = '';
            if (state.chatHistory.length === 0) {
                container.innerHTML = `<div class="msg-bubble msg-bot">Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Dza-Genius ğŸ‘‹<br>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ.<br>Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©!</div>`;
                return;
            }
            state.chatHistory.forEach(msg => {
                // Simplified render for history (calling logic is complex to duplicate, just rendering text/html)
                const div = document.createElement('div');
                div.className = `msg-bubble ${msg.role === 'user' ? 'msg-user' : 'msg-bot'}`;
                div.innerHTML = msg.role === 'assistant' ? marked.parse(msg.content) : msg.content;
                container.appendChild(div);
            });
        }

        function addLoader() {
            const id = 'loader-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'msg-bubble msg-bot w-16';
            div.innerHTML = `<div class="flex gap-1 justify-center py-1"><div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div><div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div><div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div></div>`;
            document.getElementById('chatContainer').appendChild(div);
            div.scrollIntoView();
            return id;
        }
        function removeLoader(id) { const el = document.getElementById(id); if(el) el.remove(); }
        
        function nav(pageId, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('view-'+pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            if(btn) btn.classList.add('active');
        }

        function setMode(mode, btn) {
            state.mode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => {
                b.classList.remove('active', 'border-green-500', 'text-green-400');
                b.classList.add('text-gray-400');
            });
            btn.classList.add('active', 'border-green-500', 'text-green-400');
            btn.classList.remove('text-gray-400');
            addMessage('system', `ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø´Ø®ØµÙŠØ© Ø¥Ù„Ù‰: ${CONFIG.modes[mode].name}`);
        }

        // --- Tools Logic (Weather, CCP, etc.) ---
        function calcKey() {
            const num = document.getElementById('ccpInput').value;
            if(num) {
                const key = 97n - ((BigInt(num) * 100n) % 97n);
                document.getElementById('ccpRes').innerText = `Ø§Ù„Ù…ÙØªØ§Ø­: ${key.toString().padStart(2, '0')}`;
            }
        }
        
        function loadState() {
            const h = JSON.parse(localStorage.getItem('dza_history'));
            if(h) state.chatHistory = h;
            const l = JSON.parse(localStorage.getItem('dza_loc'));
            if(l) { state.lat = l.lat; state.lon = l.lon; state.city = l.city; updateUI(); }
        }

        function getUserLocation() {
            if(!navigator.geolocation) return;
            navigator.geolocation.getCurrentPosition(async (pos) => {
                state.lat = pos.coords.latitude;
                state.lon = pos.coords.longitude;
                try {
                    const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${state.lat}&lon=${state.lon}`);
                    const json = await res.json();
                    state.city = json.address.city || json.address.town || "Ù…ÙˆÙ‚Ø¹ÙŠ";
                    localStorage.setItem('dza_loc', JSON.stringify({lat:state.lat, lon:state.lon, city:state.city}));
                    updateUI();
                    refreshTools();
                } catch(e) {}
            });
        }
        
        async function refreshTools() {
            try {
                const wRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${state.lat}&longitude=${state.lon}&current_weather=true`);
                const wData = await wRes.json();
                document.getElementById('weatherTemp').innerText = `${Math.round(wData.current_weather.temperature)}Â°`;
                document.getElementById('windSpeed').innerText = wData.current_weather.windspeed;
                document.getElementById('weatherCity').innerText = state.city;
            } catch(e){}
            
            // Prayer Times
             if (typeof adhan !== 'undefined') {
                const coords = new adhan.Coordinates(state.lat, state.lon);
                const params = adhan.CalculationMethod.MuslimWorldLeague();
                const date = new Date();
                const pt = new adhan.PrayerTimes(coords, date, params);
                
                const next = pt.nextPrayer();
                const names = {fajr:'Ø§Ù„ØµØ¨Ø­', dhuhr:'Ø§Ù„Ø¸Ù‡Ø±', asr:'Ø§Ù„Ø¹ØµØ±', maghrib:'Ø§Ù„Ù…ØºØ±Ø¨', isha:'Ø§Ù„Ø¹Ø´Ø§Ø¡', none:'ØºØ¯Ø§Ù‹'};
                if(next !== 'none') {
                    const diff = pt.timeForPrayer(next) - date;
                    const h = Math.floor(diff / 3600000);
                    const m = Math.floor((diff % 3600000) / 60000);
                    document.getElementById('nextPrayerName').innerText = names[next];
                    document.getElementById('nextPrayerCounter').innerText = `-${h}:${m.toString().padStart(2,'0')}`;
                }
             }
        }
        
        function updateTimers() { /* Placeholder for real-time countdown updates */ }
        function updateUI() { document.getElementById('headerCity').innerText = state.city; }
        function setInput(t) { document.getElementById('msgInput').value = t; sendMessage(); }
        function fullReset() { if(confirm("Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) { localStorage.clear(); location.reload(); } }
        function clearChat() { if(confirm("Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŸ")) { state.chatHistory=[]; renderChat(); localStorage.removeItem('dza_history'); } }
        function toggleVoice() { alert("Ø§Ø¶ØºØ· Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„ØªÙØ¹ÙŠÙ„ (ØªØ¬Ø±ÙŠØ¨ÙŠ)"); } // Simplified for brevity

        // Currency Calc
        function calcCurrency() {
            const amount = document.getElementById('currAmount').value;
            const rate = document.getElementById('currType').value === 'eur' ? 250 : 220; // Static rate example
            document.getElementById('currResult').innerText = (amount * rate).toLocaleString() + " DA";
        }
        document.getElementById('currAmount').addEventListener('input', calcCurrency);
        document.getElementById('currType').addEventListener('change', calcCurrency);

    </script>
</body>
</html>
